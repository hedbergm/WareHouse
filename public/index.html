<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Holship Norge AS - Delelager</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Delelager</h1>
    <p><a class="muted-link" href="/home.html" style="font-size:14px">← Til Hjem / Oversikt</a></p>
  <div id="db-banner" style="display:none;margin:-4px 0 14px 0;padding:10px 14px;border:1px solid #e2e2e2;border-left:4px solid #ff9800;background:#fff8e6;border-radius:6px;font-size:13px;color:#5a4100"></div>

  <!-- Lokasjonsadministrasjon flyttet til locations.html -->

  <section>
    <h2>Registrer del</h2>
    <div class="form-row">
      <div class="col">
        <label>Delenummer</label>
        <input id="part-number" placeholder="TAN-000623">
      </div>
      <div class="col">
        <label>Beskrivelse</label>
        <input id="part-desc" placeholder="Beskrivelse">
      </div>
      <div class="col small">
        <label>Min antall</label>
        <input id="part-min" type="number" placeholder="0">
      </div>
      <div class="col">
        <label>Fast lokasjon</label>
        <select id="part-default-loc">
          <option value="">(Ingen fast lokasjon)</option>
        </select>
      </div>
    </div>
    <div class="actions">
      <button id="add-part" class="btn">Legg til del</button>
      <div id="barcode-preview" class="barcode-box"></div>
    </div>
    <div id="parts" class="list"></div>
  </section>

  <!-- Edit Part Modal for desktop inventory -->
  <div id="edit-modal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:1000">
    <div style="background:#fff;max-width:720px;width:96%;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.25);overflow:hidden">
      <div style="padding:12px 14px;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between">
        <strong>Endre del</strong>
        <button id="ed-close" class="btn small" type="button">Lukk</button>
      </div>
      <div style="padding:12px 14px;display:flex;flex-direction:column;gap:10px">
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <div style="flex:2;min-width:220px">
            <label style="font-size:12px">Delenummer</label>
            <input id="ed-part" readonly style="width:100%;background:#f5f5f5">
          </div>
          <div style="flex:3;min-width:240px">
            <label style="font-size:12px">Beskrivelse</label>
            <input id="ed-desc" style="width:100%">
          </div>
          <div style="flex:1;min-width:140px">
            <label style="font-size:12px">Min. antall</label>
            <div style="display:flex;gap:6px;align-items:center">
              <button id="ed-min-dec" class="btn small" type="button">−</button>
              <input id="ed-min" type="number" value="0" style="flex:1">
              <button id="ed-min-inc" class="btn small" type="button">+</button>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <div style="flex:2;min-width:260px">
            <label style="font-size:12px">Fast lokasjon</label>
            <div style="display:flex;gap:6px;align-items:center">
              <select id="ed-fixed-select" style="flex:1"></select>
              <button id="ed-clear-fixed" class="btn small danger" type="button">Fjern</button>
            </div>
            <div class="muted" style="font-size:12px">Velg en lokasjon eller trykk Fjern for å slette fast lokasjon</div>
          </div>
        </div>
        <div style="margin-top:6px">
          <label style="font-size:12px">Lokasjoner og antall</label>
          <div id="ed-stock-rows" style="display:flex;flex-direction:column;gap:6px"></div>
          <div style="margin-top:6px;display:flex;gap:8px;align-items:center">
            <button id="ed-add-row" class="btn small" type="button">Legg til lokasjon</button>
            <div class="muted" style="font-size:12px">Sett eksakt antall per lokasjon. 0 fjerner beholdning.</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="ed-save" class="btn" type="button" style="flex:1">Lagre endringer</button>
          <button id="ed-cancel" class="btn danger" type="button" style="flex:1">Avbryt</button>
        </div>
        <div id="ed-msg" class="muted" style="font-size:12px"></div>
      </div>
    </div>
  </div>

  <section>
    <h2>Transaksjonslogg</h2>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
      <input id="log-filter-part" placeholder="Filter delenummer" style="flex:1;min-width:160px">
      <input id="log-filter-loc" placeholder="Filter lokasjon" style="flex:1;min-width:160px">
  <input id="log-filter-user" placeholder="Filter bruker" style="flex:1;min-width:140px">
      <select id="log-limit" style="width:120px">
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="200">200</option>
        <option value="500">500</option>
      </select>
      <button id="log-refresh" class="btn">Oppdater</button>
    </div>
    <div id="tx-log" class="list" style="max-height:320px;overflow:auto;border:1px solid #eee;border-radius:6px;background:#fff"></div>
  </section>

  <!-- Manuell skann fjernet: all bevegelse skjer via mobil skanning -->

  <script src="/app.js"></script>
    <script>
      fetch('/api/debug/status').then(r=> r.ok ? r.json():null).then(s=>{
        if(!s) return; const b=document.getElementById('db-banner'); if(!b) return;
        if(s.dbMode==='SQLite'){ b.style.display='block'; b.innerHTML='Database-modus: <strong>SQLite (midlertidig)</strong>. Data kan forsvinne ved redeploy. Sett opp Postgres for permanent lagring.'; }
        else { b.style.display='block'; b.style.background='#eef9f1'; b.style.borderLeftColor='#2e7d32'; b.style.color='#1b4d21'; b.innerHTML='Database-modus: <strong>Postgres</strong>. Parts: '+s.parts+' · Lokasjoner: '+s.locations+' · Beholdning rader: '+s.stock; }
      }).catch(()=>{});
    </script>
  </div>
</body>
</html>
